# Migration Guide: Manual DI â†’ Injectable

## ğŸ“‹ Summary

This guide covers the migration from manual dependency injection to automatic code generation using `injectable_generator`.

## ğŸ¯ What Changed

### Before (Manual Registration)
```dart
void main() {
  setupNotificationServices();
  runApp(MyApp());
}
```

### After (Injectable Generator)
```dart
void main() {
  configureDependencies();
  runApp(MyApp());
}
```

## ğŸ“¦ New Dependencies

Added to `pubspec.yaml`:
```yaml
dev_dependencies:
  build_runner: ^2.4.0
  injectable_generator: ^2.6.2
```

## ğŸ”§ Changes Made

### 1. Updated Service Implementations

All service implementations now have `@LazySingleton` annotation:

- âœ… `ResponsiveServiceImpl` (was already using `@LazySingleton`)
- âœ… `FirebaseMessagingServiceImpl` (added `@LazySingleton`)
- âœ… `LocalNotificationServiceImpl` (added `@LazySingleton`)

### 2. Created Injectable Module

**New file:** `lib/src/configuration/di/register_module.dart`

Registers external dependencies:
- `FirebaseMessaging`
- `FlutterLocalNotificationsPlugin`

### 3. Updated Locator

**File:** `lib/src/configuration/di/locator.dart`

- Removed `setupNotificationServices()` function
- Added `configureDependencies()` function with `@InjectableInit()` annotation
- Imports generated `locator.config.dart`

### 4. Generated Configuration

**Generated file:** `lib/src/configuration/di/locator.config.dart`

Auto-generated by build_runner. Contains all dependency registrations.

### 5. Updated Example

**File:** `example/notification_example.dart`

Changed from `setupNotificationServices()` to `configureDependencies()`.

## ğŸš€ How to Use

### Setup (One-time)
```bash
# Install dependencies
flutter pub get

# Generate dependency configuration
flutter pub run build_runner build --delete-conflicting-outputs
```

### In Your App
```dart
import 'package:app_core/app_core.dart';

void main() {
  // Initialize all services
  configureDependencies();
  
  // Get services from container
  final fcmService = getIt<FirebaseMessagingService>();
  final localService = getIt<LocalNotificationService>();
  final responsiveService = getIt<ResponsiveService>();
  
  runApp(MyApp());
}
```

## â• Adding New Services

1. Create your service with annotation:

```dart
import 'package:injectable/injectable.dart';

abstract class MyNewService {
  void doSomething();
}

@LazySingleton(as: MyNewService)
class MyNewServiceImpl implements MyNewService {
  @override
  void doSomething() {
    // Implementation
  }
}
```

2. Regenerate configuration:

```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

3. Use the service:

```dart
final myService = getIt<MyNewService>();
myService.doSomething();
```

## ğŸ“š Benefits

âœ… **Automatic Registration**: No need to manually register services
âœ… **Type Safety**: Compile-time dependency checking
âœ… **Scalability**: Easy to add new services
âœ… **Consistency**: All services use the same pattern
âœ… **Maintainability**: Less boilerplate code

## ğŸ”— Documentation

- [Dependency Injection Setup](lib/src/configuration/di/README.md)
- [Notification Module](lib/src/infrastructure/notification/doc/README.md)
- [Example Usage](example/notification_example.dart)

## âš ï¸ Breaking Changes

### Removed
- âŒ `setupNotificationServices()` function (replaced by `configureDependencies()`)

### Migration Steps for Consumers

1. Update package version
2. Replace `setupNotificationServices()` with `configureDependencies()`
3. That's it! ğŸ‰

```dart
// Before
setupNotificationServices();

// After
configureDependencies();
```

## ğŸ› Troubleshooting

### Issue: "Missing dependencies" warning during build

This is expected and can be ignored. The generated code works correctly.

### Issue: Changes not reflected

Run clean build:
```bash
flutter pub run build_runner clean
flutter pub run build_runner build --delete-conflicting-outputs
```

### Issue: Import errors

Make sure you've run `flutter pub get` after adding dependencies.

## ğŸ“ Support

For issues or questions, please refer to:
- [injectable documentation](https://pub.dev/packages/injectable)
- [get_it documentation](https://pub.dev/packages/get_it)

